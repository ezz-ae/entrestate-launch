generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model ChatAgent {
  id                String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId            String   @unique @map("user_id") @db.Uuid
  name              String?
  companyName       String?  @map("company_name")
  style             String?
  details           String?
  listings          String?
  contact           String?
  rawText           String?  @map("raw_text")
  fileUrls          String[] @default([]) @map("file_urls")
  state             String   @default("draft")
  version           Int      @default(1)
  createdAt         DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime @default(now()) @map("updated_at") @db.Timestamptz(6)
  versions          AgentVersion[]

  @@map("chat_agents")
}

model AgentVersion {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  agentId      String   @map("agent_id") @db.Uuid
  version      Int
  systemPrompt String?  @map("system_prompt")
  profile      Json?
  listings     Json?
  constraints  Json?
  createdAt    DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  agent        ChatAgent @relation(fields: [agentId], references: [id], onDelete: Cascade)

  @@map("agent_versions")
}